{% extends "base.html" %}
{% load i18n %}
{% load devtags %}
{% load history %}

{% block title %}
{{ object.title }}
{% endblock %}

{% block content %}
<main id="main" class="container" role="main">

    <div class="col-lg-12">

      <div class="page-header">
        <h2>Historial de «{{ object.title }}» </h2>
      </div>

      <div class="row">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          {% for history_entry in object_list %}
          <div class="panel panel-default">
              <div class="panel-heading" role="tab">
                  <div class="row" role="button" data-toggle="collapse" href="#change-{{ forloop.counter }}" aria-expanded="false" aria-controls="change-{{ forloop.counter }}">
                    <div class="col-xs-11">
                      <div class="row">
                        <div class="col-xs-3">
                          <span class="glyphicon glyphicon-user"></span> <strong>{{ history_entry.user }}</strong>
                        </div>
                        <div class="col-xs-3">
                          <small>
                            Cambió <strong>5</strong> campos
                          </small>
                        </div>
                        <div class="col-xs-3">
                          {% if history_entry.content_type.model == "joboffer" %}
                          <span>{{ history_entry.get_event_type_display | upper }}</span>
                          {% else %}
                          COMMENT
                          {% endif %}
                        </div>
                        <div class="col-xs-3 text-right">
                        <small>{{ history_entry.datetime | date:"SHORT_DATE_FORMAT" }}</small>
                        <small>{{ history_entry.datetime | date:"H:m:s" }}</small>
                      </div>
                      </div>
                    </div>
                    <div class="col-xs-1 text-right">
                      <span class="glyphicon glyphicon-chevron-down"></span>
                    </div>
                  </div>
              </div>
              <div id="change-{{ forloop.counter }}" class="panel-collapse collapse" role="tabpanel">
                <div class="panel-body">
                  <div class="list-group">
                    {% if history_entry.content_type.model == "joboffer" %}
                      {% if history_entry.event_type == JobOfferHistory.CREATE %}
                        <dl class="row">
                          {% for field_item in history_entry.fields.items %}
                            <dt class="col-xs-2">{{ field_item | verbose_name }}</dt>
                            {% if field_item.0 == 'description' %}
                              <dd class="col-xs-10">{{ field_item | value | safe }}</dd>
                            {% else %}
                              <dd class="col-xs-10">{{ field_item | value | default:"-" }}</dd>
                            {% endif %}
                          {% endfor %}
                        </dl>
                      {% endif %}

                      {% for field_name, update in history_entry.changes.items %}
                      <div class="list-group-item">
                        {{ field_name }}: <span class="label label-default">{{ update.0 }}</span> -> <span class="label label-default">{{ update.1 }}</span>
                      </div>
                      {% endfor %}
                    {% else %}
                      <div class="list-group-item">
                        comment_type: <span class="label label-default">{{ history_entry.fields.0.fields.comment_type }}</span>
                      </div>
                      <div class="list-group-item">
                        text: <span class="label label-default">{{ fields.0.fields.text }}</span>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
          </div>
          {% endfor %}
        </div>
      </div>

    </div>
</main>
{% endblock %}
